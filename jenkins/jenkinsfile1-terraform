#!/usr/bin/env groovy
properties([disableConcurrentBuilds()])

pipeline {
  agent {
    label 'ubuntu'
  }
  options {
    timestamps()
  }
  stages {
    stage('Check terraform') {
      steps {
        sh "terraform --version"
      }
    }
    stage('Az login'){
      steps {
        script {
          withCredentials([
            string(credentialsId:'APP_ID', variable: 'id'),
            string(credentialsId:'PASSWORD', variable: 'password'),
            string(credentialsId:'TENANT_ID', variable: 'tenant')
          ]) {
            sh "az login --service-principal --username id --password password --tenant tenant"
          }
        }
      }
    }
    stage('Terraform init') {
      steps {
        sh "terraform init"
      }
    }
    stage('Terraform init') {
      steps {

      }
    }
  }
}